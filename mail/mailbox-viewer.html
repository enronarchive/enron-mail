<!DOCTYPE html>
<html>

<head>
	<title>Enron WebMail: Mailbox</title>
	<link rel="stylesheet" href="/src/mail.css" type="text/css">
	<style>
	.menuimage {
		cursor: pointer;
	}
	a { text-decoration: none; }
	
	/* Email list styles */
	.email-list {
		width: 100%;
		border-collapse: collapse;
	}
	.email-list th {
		background-color: #0066cc;
		color: #ff9900;
		font-weight: bold;
		padding: 8px;
		text-align: left;
		border: 1px solid #0066cc;
		font-size: 10pt;
	}
	.email-row {
		border-bottom: 1px solid #e0e0e0;
		cursor: pointer;
		background-color: #fff;
	}
	.email-row:hover {
		background-color: #f8f8f8;
	}
	.email-row.unread {
		font-weight: bold;
	}
	.email-row td {
		padding: 6px 8px;
		font-size: 11px;
		border-left: 1px solid #e0e0e0;
		border-right: 1px solid #e0e0e0;
	}
	.email-from {
		width: 25%;
		color: #333;
	}
	.email-subject {
		width: 50%;
		color: #0066cc;
	}
	.email-date {
		width: 25%;
		color: #666;
		text-align: right;
	}
	.email-attachment {
		display: none;
	}
	.attachment-icon {
		color: #ff9900;
	}
	
	/* Folder list styles */
	.folder-list {
		margin: 10px 0;
	}
	.folder-item {
		padding: 6px 10px;
		margin: 2px 0;
		cursor: pointer;
		border-radius: 3px;
		font-size: 11px;
	}
	.folder-item:hover {
		background-color: #e0e0e0;
	}
	.folder-item.active {
		background-color: #0066cc;
		color: white;
		font-weight: bold;
	}
	.folder-count {
		float: right;
		color: #999;
		font-size: 10px;
	}
	
	/* Search box */
	.search-box {
		width: 100%;
		padding: 8px;
		border: 2px solid #0066cc;
		border-radius: 4px;
		font-size: 12px;
		margin-bottom: 15px;
		box-sizing: border-box;
	}
	
	/* Search highlight in email body */
	.search-highlight {
		background-color: #ff9900;
		color: #000;
		padding: 2px 0;
		font-weight: bold;
	}
	
	/* Loading indicator */
	.loading {
		text-align: center;
		padding: 40px;
		color: #0066cc;
		font-size: 14px;
	}
	
	/* No results */
	.no-results {
		text-align: center;
		padding: 40px;
		color: #666;
		font-style: italic;
	}
	
	/* Pagination */
	.pagination {
		text-align: center;
		padding: 15px;
		margin-top: 10px;
	}
	.pagination a {
		text-decoration: none;
		border: none;
		outline: none;
		display: inline-block;
		line-height: 0;
	}
	.pagination a img {
		display: block;
		border: none;
	}
	.pagination button {
		background-color: #0066cc;
		color: white;
		border: none;
		padding: 8px 15px;
		margin: 0 5px;
		cursor: pointer;
		border-radius: 3px;
		font-size: 11px;
	}
	.pagination button:hover {
		background-color: #004499;
	}
	.pagination button:disabled {
		background-color: #ccc;
		cursor: not-allowed;
	}
	.pagination .page-info {
		display: inline-block;
		margin: 0 15px;
		font-size: 11px;
		color: #666;
	}

	/* Inline email detail view */
	.back-link {
		color: #0066cc;
		text-decoration: none;
		font-weight: bold;
		font-size: 11px;
		margin-bottom: 15px;
		display: inline-block;
	}
	.back-link:hover { text-decoration: underline; }
	.email-headers {
		background-color: #f5f5f5;
		border: 1px solid #ccc;
		padding: 15px;
		margin: 15px 0;
	}
	.email-headers table { width: 100%; font-size: 11px; }
	.email-headers td { padding: 4px; vertical-align: top; }
	.email-headers td:first-child { font-weight: bold; color: #0066cc; width: 80px; }
	.email-from-value {
		font-weight: bold;
		color: #ff9900;
	}
	.email-subject-value {
		font-weight: bold;
		color: #ff9900;
	}
	.collapsible-list {
		margin: 0;
		padding: 0;
	}
	.collapsible-toggle {
		color: #0066cc;
		cursor: pointer;
		text-decoration: underline;
		font-size: 11px;
		display: block;
		margin-top: 8px;
		clear: both;
	}
	.collapsible-toggle:hover {
		color: #ff9900;
	}
	.collapsible-content {
		display: none;
		margin-top: 5px;
	}
	.collapsible-content.expanded {
		display: block;
	}
	.attachment-item {
		display: inline-flex;
		align-items: center;
		margin: 3px 5px 3px 0;
		padding: 4px 8px;
		background-color: #0066cc;
		border: 1px solid #0066cc;
		border-radius: 3px;
		cursor: pointer;
		transition: background-color 0.2s;
	}
	.attachment-item:hover {
		background-color: #ff9900;
		border-color: #ff9900;
	}
	.attachment-item a {
		color: white;
		text-decoration: none;
		font-size: 11px;
	}
	.attachment-item:hover a {
		color: #0066cc;
	}
	.attachment-icon {
		width: auto;
		height: auto;
		margin-right: 6px;
		display: inline-block;
		font-size: 9px;
		font-weight: bold;
		color: white;
		background-color: rgba(255, 255, 255, 0.2);
		padding: 2px 4px;
		border-radius: 2px;
		border: 1px solid rgba(255, 255, 255, 0.3);
		font-family: monospace;
	}
	.attachment-item:hover .attachment-icon {
		color: #0066cc;
		background-color: rgba(0, 102, 204, 0.1);
		border-color: #0066cc;
	}
	.email-body-container {
		border: 1px solid #ccc;
		padding: 15px;
		background: #fff;
		min-height: 200px;
		font-size: 11px;
		line-height: 1.6;
		overflow-wrap: break-word;
		word-wrap: break-word;
		word-break: break-word;
		overflow-x: auto;
		max-width: 100%;
	}
	</style>
</head>

<body bgcolor="#ffffff">

	<!-- Menu image changer-->
    <script>
        function changeImage(newSrc, imgId) {
            document.getElementById(imgId).src = newSrc;
        }
    </script>

<div align="center">

<table border="0" width="727" cellspacing="0" cellpadding="0">

<tr><td colspan="13" style="line-height:0; font-size:0;"><img src="/src/topbar.jpg" width="727" height="93" border="0" style="display:block"></td></tr>
<!-- Blue separator to eliminate any white seam under topbar -->
<tr><td colspan="13" bgcolor="#0066cc"><img src="/src/spacer.gif" width="1" height="1" alt=""></td></tr>
<tr>
	<td valign="top" align="left" width="1" class="gridLine" bgcolor="#0066cc" rowspan=2><br /></td>
	<td valign="top" colspan=10 rowspan=2>

		<!-- Title and Menu -->
		<table cellspacing=0 cellpadding=0 border=0 width=604>
			<tr>
				<td style="padding: 10px 13px;">
				<!-- Uniform padding on all sides for content area -->
				<!--Title-->
				<h2 id="mailbox-title">WebMail: Loading...</h2>
				<!--Menu-->
				<nobr>
						<img id="back" class="menuimage" src="/src/back_off.jpg" onclick="goBack()" onmouseover="changeImage('/src/back_on.jpg', 'back')" onmouseout="changeImage('/src/back_off.jpg', 'back')" alt="Back">	
						<img src="/src/spacer.gif" width="5" height="33">
						<img id="new" class="menuimage" src="/src/compose_off.jpg" alt="Compose" style="opacity: 0.5; cursor: not-allowed;">
						<img src="/src/spacer.gif" width="5" height="33">
						<img id="inbox" class="menuimage" src="/src/inbox_on.jpg" alt="Inbox">
						<img src="/src/spacer.gif" width="5" height="33">
					<img id="help" class="menuimage" src="/src/help_off.jpg" alt="Get help" style="opacity: 0.5; cursor: not-allowed;">
					<img src="/src/spacer.gif" width="5" height="33">
					<img id="exit" class="menuimage" src="/src/exit_off.jpg" onclick="app.logout()" onmouseover="changeImage('/src/exit_hover.jpg', 'exit')" onmouseout="changeImage('/src/exit_off.jpg', 'exit')" alt="Log Off">
			</nobr>
					<br><br>
					<img src="/src/024.gif" width="700" height="1"><br><br>
				
				<!-- Search Box -->
				<input type="text" id="search-box" class="search-box" placeholder="Search emails by subject, sender, or content..." onkeyup="handleSearch()" />
				
				<!-- Main Content Area -->
				<table cellspacing=0 cellpadding=0 border=0 width=700>
					<tr>
						<td valign="top" width="150" style="border-right: 1px solid #ccc; padding-right: 10px;">
							<!-- Folder List -->
							<div id="folder-list" class="folder-list">
								<div class="loading">Loading folders...</div>
							</div>
						</td>
						<td valign="top" style="padding-left: 10px;">
							<!-- Email List -->
							<div id="email-list-container">
								<div class="loading">Loading emails...</div>
							</div>

							<!-- Inline email detail view -->
							<div id="email-detail" style="display:none;">
								<div id="email-detail-content"></div>
							</div>

							<!-- Pagination -->
							<div class="pagination" id="pagination" style="text-align:center; display:none;">
								<a href="#" id="prev-link" data-disabled="false"
									onmouseover="if(this.dataset.disabled!=='true'){document.getElementById('prev-img').src='/src/previous_hover.png'}"
									onmouseout ="if(this.dataset.disabled!=='true'){document.getElementById('prev-img').src='/src/previous_on.png'}"
									onclick   ="if(this.dataset.disabled==='true') return false; app.previousPage(); return false;">
									<img id="prev-img" src="/src/previous_on.png" alt="Previous" style="vertical-align:middle;">
								</a>
								<img src="/src/spacer.gif" width="5" height="33" alt="">
								<span class="page-info" id="page-info" style="vertical-align:middle;"></span>
								<img src="/src/spacer.gif" width="5" height="33" alt="">
								<a href="#" id="next-link" data-disabled="false"
									onmouseover="if(this.dataset.disabled!=='true'){document.getElementById('next-img').src='/src/next_hover.png'}"
									onmouseout ="if(this.dataset.disabled!=='true'){document.getElementById('next-img').src='/src/next_on.png'}"
									onclick   ="if(this.dataset.disabled==='true') return false; app.nextPage(); return false;">
									<img id="next-img" src="/src/next_on.png" alt="Next" style="vertical-align:middle;">
								</a>
							</div>
						</td>
					</tr>
				</table>
				
				</td>
			</tr>
		</table>
	</td>
	<td valign="top" align="left" width="1" class="gridLine" bgcolor="#0066cc" rowspan=1><br /></td>
</tr>

<!-- bottom pinstripe -->
<tr><td valign="top" class="gridLine" bgcolor="#0066cc" colspan="13" style="line-height:0; font-size:0;"><img src="/src/spacer.gif" width="1" height="1" alt="spacer" style="display:block;"></td></tr>

<tr><td colspan=13 style="line-height:0; font-size:0;"><img src="/src/bottombar.gif" style="display:block;"></td></tr>

</table>

</div>

<script src="mailbox-app.js"></script>
<script>
	// Handle back button - go back to search if coming from search, otherwise go to mailbox index
	function goBack() {
		console.log('goBack called');
		console.log('from_search_direct flag:', sessionStorage.getItem('from_search_direct'));
		if (sessionStorage.getItem('from_search_direct')) {
			console.log('Going back to search page');
			sessionStorage.removeItem('from_search_direct');
			sessionStorage.setItem('from_search', 'true');
			window.location.href = '/search.html';
		} else {
			console.log('Using history.back()');
			history.back();
		}
	}
</script>

</body>
</html>
